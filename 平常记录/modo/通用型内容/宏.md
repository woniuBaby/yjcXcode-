```objc
// 作用域标记，避免编译器警告
#if DEBUG
    #define nt_keywordify @autoreleasepool {}
#else
    #define nt_keywordify @try {} @finally {}
#endif

// 为任意对象创建 weak 引用
#define nt_weakify(object) \
    nt_keywordify \
    __weak __typeof__(object) nt_weak_##object = (object);

// 为任意对象创建 strong 引用（从 weak 引用转换）
#define nt_strongify(object) \
    nt_keywordify \
    _Pragma("clang diagnostic push") \
    _Pragma("clang diagnostic ignored \"-Wshadow\"") \
    __strong __typeof__(object) object = nt_weak_##object; \
    _Pragma("clang diagnostic pop")

// 带自动返回的版本（如果对象已释放则自动 return）
#define nt_strongify_and_return_if_nil(object) \
    nt_strongify(object); \
    if (!object) return;


#pragma mark - 专门针对 self 的宏（传统风格）

// 为 self 创建 weakSelf 变量
#define nt_weakify_self() \
    __weak __typeof__(self) weakSelf = self;

// 为 self 创建 strongSelf 变量（带自动返回）
#define nt_strongify_self() \
    __strong __typeof__(weakSelf) strongSelf = weakSelf; \
    if (!strongSelf) return;

// 为 self 创建 strongSelf 变量（不带返回，允许继续执行）
#define nt_strongify_self_no_return() \
    __strong __typeof__(weakSelf) strongSelf = weakSelf;


#pragma mark ---------------------------------------------------------------------


#ifndef REGEXP
# define _regexp_stringify(x)       #x
# define _regexp_stringify2(x)      _regexp_stringify(x)
# define _regexp(...)               ({ const char *str = _regexp_stringify2(# __VA_ARGS__); const size_t length = strlen(str); [[NSString alloc] initWithBytes:str + 1 length:length - 2 encoding:NSUTF8StringEncoding]; })
# define REGEXP(...)                [NSRegularExpression regularExpressionWithPattern:_regexp(__VA_ARGS__) options:0 error:NULL]
#endif

#define HOME_INDICATOR_HEIGHT (ex_isIPhoneXSeries() ? 34.f : 0.f)

/// 获取系统对象
#define kApplication        [UIApplication sharedApplication]
#define kAppWindow          [UIApplication sharedApplication].delegate.window
#define kAppDelegate        (AppDelegate *)[UIApplication sharedApplication].delegate
#define kRootViewController [UIApplication sharedApplication].delegate.window.rootViewController
#define kUserDefaults       [NSUserDefaults standardUserDefaults]
#define kNotificationCenter [NSNotificationCenter defaultCenter]

/// 转化模型属性名为NSString
#define keyPath(objc, keyPath)   @(((void)objc.keyPath, #keyPath))

/// 版本号
#define kVersion [[NSBundle mainBundle] objectForInfoDictionaryKey:@"CFBundleShortVersionString"]
#define kVersionBuild [[NSBundle mainBundle] objectForInfoDictionaryKey:@"CFBundleVersion"]

/// 获取硬件信息
#define kScreen_Bounds      [UIScreen mainScreen].bounds
#define kScreen_Width       ([UIScreen mainScreen].bounds.size.width)
#define kScreen_Height      ([UIScreen mainScreen].bounds.size.height)
#define kScreen_Scale       ([[UIScreen mainScreen] scale])
#define kScreen_NativeScale ([[UIScreen mainScreen] nativeScale])

#define SCREENBOUNS_WIDTH MIN([UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height)
#define SCREENBOUNS_HEIGHT MAX([UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height)

/// 按iPhone6的比例调整
#define kScaleWidthFrom_iPhone6 kScreenWidth/375.0f
#define kScaleHeightFrom_iPhone6 kScreenHeight/667.0f
#define KScaleFrom_iPhone6_Desgin(_X_) (_X_ * (kScreen_Width/375.0f))

/// G－C－D
#define dispatch_asynGlobalQueue(block) dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), block)
#define dispatch_asynMainQueue(block) dispatch_async(dispatch_get_main_queue(),block)

/// 获取一段时间间隔
#define kStartTime CFAbsoluteTime start = CFAbsoluteTimeGetCurrent();
#define kEndTime   NSLog(@"Time: %f", CFAbsoluteTimeGetCurrent() - start)

/// AFN 可接受的数据类型
#define kAFNAcceptContentTypes    [NSSet setWithObjects:@"application/json", @"text/json", @"text/javascript",@"text/html",@"text/plain",@"charset=utf-8", nil];

/// UIColor 相关的宏
#define UIColorMake(r, g, b) [UIColor colorWithRed:r/255.0 green:g/255.0 blue:b/255.0 alpha:1]
#define UIColorMakeWithRGBA(r, g, b, a) [UIColor colorWithRed:r/255.0 green:g/255.0 blue:b/255.0 alpha:a/1.0]

#define CodeFontMake(_pointSize) [UIFont fontWithName:@"Menlo" size:_pointSize]

/// scrollView 不接受系统的强制偏移
#define AdjustsScrollViewInsetNever(controller,view) if(@available(iOS 11.0, *)) {view.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;} else if([controller isKindOfClass:[UIViewController class]]) {controller.automaticallyAdjustsScrollViewInsets = false;}

/// storyboard
#define UIStoryboardLoadInitialViewController(storyboardName) [[UIStoryboard storyboardWithName:storyboardName bundle:nil] instantiateInitialViewController]
#define UIStoryboardLoadViewControllerWithIdentifier(storyboardName, identifier) [[UIStoryboard storyboardWithName:storyboardName bundle:nil] instantiateViewControllerWithIdentifier:identifier]

/// Delegate
#define DelegateCallBack(delegate, SEL) if (delegate && [delegate respondsToSelector:SEL]) [delegate performSelector:SEL]
#define DelegateCallBack_One_Parameter(delegate, SEL, X) if (delegate && [delegate respondsToSelector:SEL]) [delegate performSelector:SEL withObject:X]
#define DelegateCallBack_Two_Parameter(delegate, SEL, X, Y) if (delegate && [delegate respondsToSelector:SEL]) [delegate performSelector:SEL withObject:X withObject:Y]

/// Safe Queue
#ifndef dispatch_queue_async_safe
#define dispatch_queue_async_safe(queue, block)\
if (dispatch_queue_get_label(DISPATCH_CURRENT_QUEUE_LABEL) == dispatch_queue_get_label(queue)) {\
block();\
} else {\
dispatch_async(queue, block);\
}
#endif

#ifndef dispatch_main_async_safe
#define dispatch_main_async_safe(block) dispatch_queue_async_safe(dispatch_get_main_queue(), block)
#endif

#ifndef XT_LOCK
#define XT_LOCK(lock) dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);
#endif

#ifndef XT_UNLOCK
#define XT_UNLOCK(lock) dispatch_semaphore_signal(lock);
#endif

// 刘海屏判断
#define iPhoneX ({ \
    BOOL iPhoneX = NO; \
    if (@available(iOS 11.0, *)) { \
        if ([UIApplication sharedApplication].windows[0].safeAreaInsets.bottom > 0) { \
            iPhoneX = YES; \
        } \
    } \
    iPhoneX; \
})



static inline BOOL ex_isZeroFloat(CGFloat floatValue){
    CGFloat epsinon = 0.00001;
    if ((floatValue >= -epsinon) && (floatValue <= epsinon)) {
        return YES;
    }
    
    return NO;
}

/// 字符串的判断
static inline BOOL ex_isEmptyString(id aString){
    return aString==nil ||
    [aString isEqual:[NSNull null]] ||
    [aString isEqual:@"null"] ||
    [aString isEqual:@"(null)"] ||
    [aString respondsToSelector:@selector(length)]==NO ||
    [aString length]==0;
}

static inline BOOL ex_isValidString(id aString){
    return !ex_isEmptyString(aString);
}

/// 判断对象是否为空
static inline BOOL ex_isEmpty(id thing) {
    return thing == nil ||
    [thing isEqual:[NSNull null]] ||
    [thing isEqual:@"null"] ||
    [thing isEqual:@"(null)"] ||
    ([thing respondsToSelector:@selector(length)]
     && [(NSData *)thing length] == 0) ||
    ([thing respondsToSelector:@selector(count)]
     && [(NSArray *)thing count] == 0);
}

static inline BOOL ex_isValidObject(id thing){
    return !ex_isEmpty(thing);
}

/// 获取非空字符串
static inline NSString *ex_nonullString(NSString *obj) {
    if (obj == nil ||
        [obj isEqual:[NSNull null]] ||
        [obj isEqual:@"(null)"] ||
        [obj isEqual:@"null"]) {
        return @"";
    }
    return obj;
}

/// 判断是否是数组，如果不是返回 nil
static inline NSArray *ex_safeArray(NSArray *aArray){
    return (aArray != nil && [aArray respondsToSelector:@selector(objectAtIndex:)]) ? aArray : nil;
}

/// 判断是否是字典，如果不是返回 nil
static inline NSDictionary *ex_safeDictionary(NSDictionary *aDictionary){
    return (aDictionary != nil && [aDictionary respondsToSelector:@selector(objectForKey:)]) ? aDictionary : nil;
}

/// 判断是否是 iPhone X 系列
static inline BOOL ex_isIPhoneXSeries() {
    float statusHeight = [[UIApplication sharedApplication] statusBarFrame].size.height;
    if (statusHeight > 20){
        return YES;///是刘海屏
    }else{
        return NO;///不是刘海屏
    }
}

static inline NSString* judgeIphoneType() {
    struct utsname systemInfo;
    uname(&systemInfo);
    NSString * phoneType = [NSString stringWithCString: systemInfo.machine encoding:NSASCIIStringEncoding];
    
    // simulator 模拟器
    if ([phoneType isEqualToString:@"i386"]) {
        return @"Simulator";
    }
    if ([phoneType isEqualToString:@"x86_64"]) {
        return @"Simulator";
    }
    
    //  常用机型  不需要的可自行删除
   ...
    if ([phoneType isEqualToString:@"iPhone14,3"]) {
        return @"iPhone 13  Pro Max";
    }
    return phoneType;
    
}

/** 获取 keyWindow */
static inline UIWindow *Nt_GetKeyWindow(void) {
    UIWindow *keyWindow = nil;
#if __IPHONE_OS_VERSION_MAX_ALLOWED >= 130000 // 编译时检查SDK版本（兼容不同版本的Xcode，防止编译报错）
    if (@available(iOS 13.0, *)) { // 运行时检查系统版本（兼容不同版本的系统，防止运行报错）
        NSSet<UIScene *> *connectedScenes = [UIApplication sharedApplication].connectedScenes;
        for (UIScene *scene in connectedScenes) {
            if (scene.activationState == UISceneActivationStateForegroundActive && [scene isKindOfClass:[UIWindowScene class]]) {
                UIWindowScene *windowScene = (UIWindowScene *)scene;
                for (UIWindow *window in windowScene.windows) {
                    if (window.isKeyWindow) {
                        keyWindow = window;
                        break;
                    }
                }
            }
        }
    }
#endif
        
    if (!keyWindow) {
        keyWindow = [UIApplication sharedApplication].windows.firstObject;
        if (!keyWindow.isKeyWindow) {
#if __IPHONE_OS_VERSION_MIN_REQUIRED < 130000
            UIWindow *window = [UIApplication sharedApplication].keyWindow;
            if (CGRectEqualToRect(window.bounds, UIScreen.mainScreen.bounds)) {
                keyWindow = window;
            }
#endif
        }
    }
    
    return keyWindow;
}

```

