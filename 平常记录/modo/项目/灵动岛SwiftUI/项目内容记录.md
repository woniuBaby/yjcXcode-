1.pod è®°å½•å†…å®¹

```objc
1://è¿œç¨‹è·¯å¾„ 
 pod 'ActivitySDK',:git =>"ssh://git@192.168.13.252:8022/modo_ios/activitysdk.git"
 pod 'ActivityUI',:git => "ssh://git@192.168.13.252:8022/modo_ios/activityui.git"	
   
   
   //æœ¬åœ°è·¯å¾„
 # pod  'ActivityUI', :path => '../LiveActivity/ActivityUI'
   pod  'ActivitySDK', :path => '/Users/lin/Desktop/gameProject/LiveActivity/ActivitySDK'
   
     
  //æ‰©å±•Extension æ·»åŠ SDK 
   target 'HZWLiveActivityExtension' do
  #    inherit! :search_paths
  pod  'ActivityUI',:git => "ssh://git@192.168.13.252:8022/modo_ios/activityui.git"
#  pod  'ActivityUI', :path => '../LiveActivity/ActivityUI'
end
   
2.//# åœ¨pod ä¸­å¼ºåˆ¶æ›´æ”¹ä¸ºåŠ¨æ€,ç›®çš„æš´éœ² Swift API(æ·»åŠ åœ¨èƒ½åŠ›SDK(è¢«è®¾ç½®è¦†ç›–æˆä¸ºäº†é™æ€åº“))
    
    /*ä¸ºä»€ä¹ˆ?  
    åœ¨podä¸­ ä¸‹é¢RNåº“ è¦†ç›–å…¨å±€ éƒ½æ˜¯é™æ€åº“,è€Œswiftå¼€å‘çš„SDK,OC æ˜¯æ— æ³•åœ¨é™æ€åº“ä¸­å¼•å…¥ #import <ActivitySDK/ActivitySDK-Swift.h>   
    æ²¡æœ‰è¿™ä¸ª,æˆ‘å‘ä½¿ç”¨SDK æ‰€ä»¥å¼ºåˆ¶åŠ¨æ€,ä½†æ˜¯çº¯èƒ½åŠ›SDK å¼•å…¥å,è¿˜æ˜¯æ— æ³•ä½¿ç”¨.
    éœ€è¦åœ¨ä¸»å·¥ç¨‹ä¸­ åŠ¨æ€å¼•å…¥  
   config = use_native_modules!
  use_react_native!(:path => config["reactNativePath"],:hermes_enabled => true)
    */
pre_install do |installer|
  installer.pod_targets.each do |pod|
    if pod.name == 'ActivitySDK'
      puts "ğŸ‘‰ [pre_install] å¼ºåˆ¶å°† #{pod.name} è®¾ç½®ä¸ºåŠ¨æ€ framework"
      def pod.build_type
        Pod::BuildType.dynamic_framework
      end
    end
  end
end

          
//æƒé™æ”¯æŒ  è€ƒè™‘æ˜¯ä¸æ˜¯è¦ä¸é€šçŸ¥æƒé™ä¸€èµ·åˆ¤æ–­
3.ä¸»APP
	<key>NSSupportsLiveActivities</key>
	<true/>
          
          
4.çµåŠ¨å²›ç‰ˆæœ¬ æœ€ä½æ”¯æŒ iOS 16.1
```



2. App Groups (å…±äº«å®¹å™¨)

```objc
// å†™å…¥å…±äº« UserDefaults  "group.com.hzw"
        let sharedDefaults = UserDefaults(suiteName: "group.com." + pizzaDeliveryAttributes.gameImageName)
        sharedDefaults?.set(initialContentState.totalTime, forKey: "totalTime")
        sharedDefaults?.set(initialContentState.curTime, forKey: "curTime")
        sharedDefaults?.synchronize()
```

3. ç¼–è¯‘demo æˆ–è€…é¡¹ç›®çš„æ—¶å€™ å¦‚æœæ‰¾ä¸åˆ°-swiftæ–‡ä»¶,å¯ä»¥å°è¯•ä¸€ä¸ªä¸ªçš„ç¼–è¯‘,å…ˆsdk,åèƒ½åŠ›sdk,åœ¨demo

4.ç›®å‰ActivityAttributes

```
ActivityAttributes {
    public struct ContentState: Codable, Hashable {
        public  var liveActivity_name: String //eg:ç‰¡ä¸¹èŠ±
        public  var liveActivity_status_number:Int //1,ç§æ¤ä¸­ï¼Œ 2,æˆç†Ÿ
        public  var liveActivity_status_shortString: String //ç§æ¤ä¸­:å·²æˆç†Ÿ
        public  var liveActivity_status_longString: String //èŒå£®æˆé•¿ä¸­! :å·²å¯é‡‡æ‘˜
        public  var liveActivity_plan_string: String //é²œèŠ±æˆç†Ÿå€’è®¡æ—¶ : å·²æˆç†Ÿå¯é‡‡æ‘˜
        public  var liveActivity_countdown: TimeInterval //å€’è®¡æ—¶CD
        public  var liveActivity_timestamp: TimeInterval //å€’è®¡æ—¶æ—¶é—´æˆ³
        public  var liveActivity_other: String //è¡¥å……
```

```
 NSTimeInterval timestamp = [[NSDate date] timeIntervalSince1970] + 60; // å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
        NSDictionary *dict = @{
            @"liveActivity_name": @"ç‰¡ä¸¹èŠ±",
            @"liveActivity_status_shortString": @"1",
            @"liveActivity_status_longString": @"èŒå£®æˆé•¿ä¸­!",
            @"liveActivity_plan_string": @"é²œèŠ±æˆç†Ÿå€’è®¡æ—¶",
            @"liveActivity_status_number": @(1),
            @"liveActivity_countdown":@(100),
            @"liveActivity_timestamp": @(timestamp),
            @"liveActivity_button_name":@"å‰å¾€èŠ±å›­"
        };
```

5. swiftå¼€å‘çš„SDK,æƒ³è¦OCè°ƒç”¨,æ˜¯å¿…é¡»åšæˆåŠ¨æ€åº“å—?

ç°åœ¨æ— æ³•ç¼–è¯‘æˆä¸ºåŠ¨æ€åº“çš„åŸå› :

```objective-c
è¿™é‡Œä¹‹æ‰€ä»¥å‡ºç°æ— æ³•ç¼–è¯‘å¯èƒ½åŸå› :

//ä¸»å·¥ç¨‹ Pod é›†æˆæ¨¡å¼æ˜¯é™æ€åº“ï¼ˆé»˜è®¤ for RNï¼‰,React Native å·¥ç¨‹çš„ Podfile å†…éƒ¨è°ƒç”¨çš„ï¼š
use_native_modules!
use_react_native!

//è¿™ä¸¤ä¸ª Helper é»˜è®¤ä¼šè®¾ç½®ï¼šæ‰€æœ‰æ¨¡å—éƒ½ä»¥é™æ€æ–¹å¼é“¾æ¥ï¼ˆé™æ€åº“ï¼‰
//å› ä¸º RN é»˜è®¤ç”¨ Hermesã€Flipperã€JSC ç­‰ï¼ŒåŠ¨æ€é“¾æ¥ä¼šå¯¼è‡´å†²çªã€‚
//è¿™æ„å‘³ç€æ— è®ºä½ çš„ Podspec æ˜¯ä»€ä¹ˆï¼Œå®ƒéƒ½ä¼šè¢«æ‰“æˆ .aã€‚

//èƒ½åŠ›SDK  config = use_native_modules! use_react_native!
target 'NativeBility' do
  project "../modo-native-ability-ios/NativeBility/NativeBility.xcodeproj"
  config = use_native_modules!
  use_react_native!(:path => config["reactNativePath"],:hermes_enabled => true)
...

//æ‰€ä»¥ä¸ºäº†èƒ½åŠ›sdk å¯ä»¥è°ƒç”¨ ActivitySDK(swift sdk) å¼ºåˆ¶åŠ¨æ€è¿™æ ·å°±å¯ä»¥å¼•å…¥å¤´æ–‡ä»¶
//ç„¶åä¸»å·¥ç¨‹ä¹Ÿè¦è¿›è¡Œ å¼•å…¥çœŸæ­£çš„åŠ¨æ€,è¿™æ ·å®ç°åŠŸèƒ½
 pre_install do |installer|
    installer.pod_targets.each do |pod|
      if pod.name == 'ActivitySDK'
        puts "ğŸ‘‰ [pre_install] å¼ºåˆ¶å°† #{pod.name} è®¾ç½®ä¸ºåŠ¨æ€ framework"
        def pod.build_type
          Pod::BuildType.dynamic_framework
        end
      end
    end
  end
end
  
```

> æ”¾åœ¨å“ª?

å› ä¸ºæ˜¯éœ€è¦åœ¨ NativeBility æ‰€ä»¥è¦æ”¾åœ¨  âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸

```
 target 'NativeBility' do

end
 
 
 
 pre_install do |installer|
    installer.pod_targets.each do |pod|
      if pod.name == 'ActivitySDK'
        puts "ğŸ‘‰ [pre_install] å¼ºåˆ¶å°† #{pod.name} è®¾ç½®ä¸ºåŠ¨æ€ framework"
        def pod.build_type
          Pod::BuildType.dynamic_framework
        end
      end
    end
  end
```

> èŠ±å›­ä¸­æœ‰ä¸ªç‰¹æ®Šçš„åœºæ™¯  





````
"test": ["https://apitest.babigame.cn", "https://apitest.modo.cn"],
["https://zyd.modo.cn:51042"]
````

```
namespace mo.AB.LIVE_ACTIVITY {

    /** æŸ¥è¯¢æœ€å‰é¢çš„æ•°æ® */
    export interface IOpt_query {}

    export interface IRsp_query {
        /** åˆ›å»ºæ—¶é€ä¼ çš„idï¼Œå­˜åœ¨æ—¶è¿”å›idï¼Œä¸å­˜åœ¨æ—¶ï¼Œä¸è¿”å› */
        id?:string;
        /** çµåŠ¨å²›tokenï¼ŒiOSå¿…è¿” */
        token?:string;
        /** çµåŠ¨å²›æ´»åŠ¨idï¼ŒiOSå¿…è¿” */
        activityId?:string;
    }

    export interface ITextItem {
        /** æ–‡æœ¬ **/
        text:string;
        /** æ–‡æœ¬å±æ€§ **/
        style?:ITextStyle;
        /** æ˜¯å¦åˆ†æ®µ,ä¸ºtrueæ—¶æ–°å¯ä¸€ä¸ªæ®µè½ **/
        section?:boolean
    }

    /** æ–‡æœ¬å±æ€§ **/
    export interface ITextStyle {
        /** é¢œè‰² **/
        color ?: string;
        /** æ˜¯å¦åŠ ç²— **/
        bold  ?: boolean;
        /** å­—ä½“å¤§å° **/
        fontSize ?: number;
        /** ä½ç½® **/
        align ?: "center" | "left" | "right";
        /** èƒŒæ™¯é¢œè‰² */
        bgColor?: string;
    }

    export interface IDynamicIslandDisplay {
        /** æ ‡é¢˜ï¼Œç”¨äºå¡ç‰‡å’ŒçµåŠ¨å²›ã€‚ç¤ºä¾‹ï¼šç«ç‘°èŠ±Â·ç”Ÿé•¿ä¸­ï¼ */
        title: ITextItem[];
        /** completedå¿…å¡«ã€‚å‰¯æ ‡é¢˜ï¼Œç”¨äºå¡ç‰‡å’ŒçµåŠ¨å²›ï¼Œç¤ºä¾‹ï¼šé²œèŠ±æˆç†Ÿå€’è®¡æ—¶: [%s] */
        subTitle?: ITextItem[];
        /** countdownå¿…å¡«ã€‚æŒ‰é’®æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šå‰å¾€èŠ±å›­  */
        btn?: ITextItem;
        /** completedå¿…å¡«ã€‚å€’è®¡æ—¶å®Œæˆæç¤ºï¼šå‰å¾€é‡‡æ‘˜ */
        tip?: ITextItem;
        /** iconå›¾ç‰‡ï¼Œhttpså›¾ç‰‡é“¾æ¥ */
        icon?: string;
    }

    /** åˆ›å»ºå®æ—¶æ´»åŠ¨ï¼ˆçµåŠ¨å²›ï¼‰ */
    export interface IOpt_request {
        direction: 'left' | 'right';
        /** çµåŠ¨å²›å±•ç¤ºå†…å®¹å”¯ä¸€ID */
        id: string;
        /** å€’è®¡æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’ */
        time: ITextItem;
        countdown: IDynamicIslandDisplay;
        completed: IDynamicIslandDisplay;
    }
    export interface IRsp_request {
        /** çµåŠ¨å²›tokenï¼ŒiOSå¿…è¿” */
        token?:string;
        /** çµåŠ¨å²›æ´»åŠ¨idï¼ŒiOSå¿…è¿” */
        activityId?:string;
    }

    /** æ›´æ–°çµåŠ¨å²› */
    export interface IOpt_update extends IOpt_request {}

    export interface IRsp_update extends IOpt_request {}

    /** å…³é—­å®æ—¶æ´»åŠ¨ */
    export interface IOpt_end {
        /** çµåŠ¨å²›å±•ç¤ºå†…å®¹å”¯ä¸€ID */
        id:string;
    }

    export interface IRsp_end {}


}
```

**ä¸è¦åœ¨ Live Activity / SwiftUI å±‚ç›´æ¥ä½¿ç”¨è¿™å¥—å¤æ‚å¯¹è±¡ç»“æ„ã€‚**

> âœ… **æ¨èæ–¹æ¡ˆï¼š**
>
> - **OC å±‚ï¼šå®Œæ•´è§£ææœåŠ¡ç«¯ JSON â†’ ç»“æ„åŒ– Model**
> - **ä¼ ç»™ Live Activity çš„ ContentStateï¼šåªæ”¾â€œå·²æ‰å¹³åŒ–ã€å·²è®¡ç®—å¥½çš„å±•ç¤ºæ•°æ®â€**

æ¢å¥è¯è¯´ï¼š

> **æœåŠ¡ç«¯ JSON æ˜¯â€œæè¿°å‹æ•°æ®â€**
>  **Live Activity ContentState å¿…é¡»æ˜¯â€œç»“æœå‹æ•°æ®â€**

### Live Activity çš„ç¡¬æ€§é™åˆ¶

`ContentState` å¿…é¡»ï¼š

- `Codable`
- å°ºå¯¸æå°ï¼ˆç³»ç»Ÿé™åˆ¶ï¼Œå¸¸è§é—®é¢˜ï¼‰
- **ä¸èƒ½åŒ…å«å¤æ‚åµŒå¥—å¯¹è±¡**
- **ä¸èƒ½åŒ…å« Optional + åµŒå¥— + å¤šæ€ç»“æ„**
