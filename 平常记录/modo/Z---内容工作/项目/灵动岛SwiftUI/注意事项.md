âš ï¸æ³¨æ„äº‹é¡¹

1. å¦æœ‰æƒé™ï¼ˆActivityKit æƒé™ï¼‰ä» iOS 17 å¼€å§‹ï¼Œç”¨æˆ·å¯ä»¥å…³é—­â€œå®å†µæ´»åŠ¨æƒé™â€ã€‚

```objc

import ActivityKit

if #available(iOS 16.1, *) {
    let info = ActivityAuthorizationInfo()
    print("areActivitiesEnabled: \(info.areActivitiesEnabled)")
    print("areActivityNotificationsEnabled: \(info.areActivityNotificationsEnabled)")
}

```

2. Deployment Target â‰¥ iOS 16.1
3. ä½ åµŒå…¥çš„ Widget Extensionï¼ˆå°ç»„ä»¶ appexï¼‰çš„ Bundle Identifier **æ²¡æœ‰ä»¥ä¸» App çš„ Bundle ID ä¸ºå‰ç¼€**ã€‚

```
æ­£ç¡®çš„ç»“æ„åº”è¯¥æ˜¯è¿™æ ·ï¼š
ç›®æ ‡	Bundle Identifier
ä¸» Appï¼ˆæˆ– SDK demoï¼‰	com.bitshort.official.ios
Widget Extension	com.bitshort.official.ios.NativeAbilityActivityWidget
Live Activity Extensionï¼ˆå¦‚æœæœ‰ï¼‰	com.bitshort.official.ios.LiveActivityExtension
```

4. ä¸» App target çš„
   `General â†’ Frameworks, Libraries, and Embedded Content` ä¸­ï¼Œ
   âœ… å·²åµŒå…¥ `.appex` æ–‡ä»¶ã€‚

   ```
   .appexï¼ˆWidget Extension æ–‡ä»¶ï¼‰å¹¶ä¸æ˜¯æ™®é€šçš„ Frameworkã€‚
   å®ƒæ˜¯ä¸€ä¸ª App Extensionï¼ˆåº”ç”¨æ‰©å±•ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¦ åµŒå…¥åˆ°ä¸» App çš„åŒ…é‡Œ
   åœ¨æ„å»ºæ—¶ä¸€èµ·ç­¾åå’Œæ‰“åŒ…ã€‚
   ```

#### .appexï¼ˆWidgetKit Extensionï¼‰å•ç‹¬æ‰“åŒ…ï¼š

- ä»¥æ¨¡æ¿å·¥ç¨‹å½¢å¼ï¼ˆä¸æ˜¯ frameworkï¼‰æ”¾åœ¨ SDK çš„èµ„æºç›®å½•ï¼›
- ç”¨æˆ·ï¼ˆå®¿ä¸» Appï¼‰åœ¨é›†æˆæ—¶ï¼š
  - å°† `.appex` æ‹–å…¥è‡ªå·±çš„å·¥ç¨‹ï¼›
  - ä¿®æ”¹ appex çš„ Bundle IDï¼›
  - å‹¾é€‰ â€œEmbed App Extensionsâ€ï¼›
  - å…±äº«åŒä¸€ä¸ª `Attributes.swift` æ¨¡å‹ï¼ˆä» SDK å¯¼å…¥ï¼‰ã€‚



5.ä¸èƒ½ä¸ä¸»SDK å¹¶å­˜

**Widget Extension å¼•ç”¨äº†ä¸» SDKï¼Œè€Œä¸» SDK åˆ transitively å¼•å…¥äº† React Native åº“ã€‚**
 â†’ React Native åº•å±‚çš„æŸäº›åº“ä½¿ç”¨äº† `UIApplication.sharedApplication`ã€‚

 **App Extensionï¼ˆåŒ…æ‹¬ WidgetKitã€Share Extensionã€Notification Service Extension ç­‰ï¼‰** ä¸­ï¼Œ
 Apple æ˜ç¡®ç¦æ­¢è®¿é—® `UIApplication.sharedApplication`ï¼Œå› ä¸ºï¼š

> Extension æ— æ³•æ§åˆ¶æ•´ä¸ª App ç”Ÿå‘½å‘¨æœŸï¼Œåªèƒ½è¿è¡Œåœ¨å®¿ä¸»ç¯å¢ƒä¸­ã€‚





---

## âœ… ä¸€å¥è¯æ€»ç»“

> çµåŠ¨å²› / Live Activities å¿…é¡»ä½œä¸º `.appex` ç‹¬ç«‹ç­¾åä¸åµŒå…¥ï¼Œ
> SDK åªå°è£…é€»è¾‘ + æä¾› appex æ¨¡æ¿ï¼Œå®¿ä¸» App é›†æˆæ—¶åµŒå…¥è¯¥ appex å³å¯ã€‚

ğŸš§ ä¸€ã€å…ˆè¯´ç»“è®ºï¼š

> âš ï¸ **çµåŠ¨å²›ç›¸å…³å†…å®¹ï¼ˆWidgetKit / ActivityKit appexï¼‰ä¸èƒ½ç›´æ¥æ‰“åŒ…è¿›å•ä¸€ SDK Framework é‡Œåˆ†å‘**ã€‚

å› ä¸ºï¼š

- `.appex`ï¼ˆæ‰©å±•ï¼‰åœ¨ iOS ç³»ç»Ÿä¸­ **å¿…é¡»ç‹¬ç«‹ç­¾å**ï¼›
- `Framework` æ— æ³•æºå¸¦å·²ç­¾åçš„ `.appex`ï¼›
- `.appex` éœ€è¦æœ‰ç‹¬ç«‹çš„ `Bundle Identifier`ã€`Info.plist`ã€`NSExtension` é…ç½®ï¼›
- ç³»ç»Ÿåœ¨è¿è¡Œæ—¶åªè¯†åˆ«ä¸» App ä¸­çš„ **PlugIns ç›®å½•ä¸‹çš„ appex**ã€‚

ğŸ§© äºŒã€ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾è¿› SDKï¼Ÿ

| æœºåˆ¶                       | é™åˆ¶                                                         |
| -------------------------- | ------------------------------------------------------------ |
| **Framework æœºåˆ¶**         | ç”¨äºå…±äº«ä»£ç ï¼Œä¸å…è®¸åµŒå…¥ç­¾åçš„ appex èµ„æº                    |
| **App Extension (.appex)** | å¿…é¡»ä½äºä¸» App çš„ `PlugIns/` ä¸­ï¼Œç”±ä¸» App ä¸€èµ·ç­¾å           |
| **ç­¾åè§„åˆ™**               | appex çš„ bundle id å¿…é¡»ä»¥ä¸» App çš„ bundle id ä¸ºå‰ç¼€          |
| **SDK åˆ†å‘é€»è¾‘**           | SDK é€šå¸¸æ˜¯è¢«å¤šä¸ª App ä½¿ç”¨ï¼Œbundle id ä¸ç¡®å®šï¼Œå› æ­¤æ— æ³•æå‰ç­¾å appex |

------

![image-20251021093808105](/Users/lin/Library/Application Support/typora-user-images/image-20251021093808105.png)





---

### å›¾ç‰‡ ä¸‹è½½æ–¹æ³•

https://blog.csdn.net/SOHU_TECH/article/details/149819894
ç½‘ç»œå›¾ç‰‡çš„å±•ç¤º

1. æŠ€æœ¯é™åˆ¶
å› ä¸ºLive Activityå†…éƒ¨ç¦ç”¨ç½‘ç»œï¼Œæ‰€ä»¥ä½ åœ¨Targetä¸­ä¸è¦ä»¥ä»»ä½•çš„å¸Œæœ›è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚AsyncImageæˆ–è€…URLSessionéƒ½æ˜¯æ— æ•ˆçš„ï¼Œå¦‚æœä½ å¸Œæœ›å±•ç¤ºç½‘ç»œå›¾ç‰‡,ä¸€ç§æ˜¯åœ¨åˆ›å»ºçš„æ—¶å€™æå‰åœ¨ä¸»é¡¹ç›®ä¸­ä¸‹è½½å¥½ï¼Œç„¶åå­˜å‚¨åˆ°ä¸€ä¸ªå…¬å…±åŒºåŸŸ(App Group)è¿™ä¸ªä¹Ÿéœ€è¦ä½ çš„å¼€å‘è€…è´¦å·è¿›è¡Œé…ç½®ï¼Œç„¶ååœ¨Targeté¡¹ç›®ä¸­éœ€è¦å±•ç¤ºçš„æ—¶å€™å»å…¬å…±åŒºåŸŸè¿›è¡ŒåŠ è½½ã€‚

2. è§£å†³æ–¹æ¡ˆ
è¯¥æ–¹æ³•å†™åœ¨ä¸»é¡¹ç›®ä¸­çš„ç®¡ç†å®æ—¶æ´»åŠ¨çš„å»¶å±•ç±»ä¸­ï¼Œä¸‹è½½å›¾ç‰‡æ–¹æ³•ï¼š



```objc
private func downloadImage(from url: URL) async throws -> URL? {
    guardvar destination = FileManager.default.containerURL(
        forSecurityApplicationGroupIdentifier: "group.com.test.liveactivityappgroup")
    else { return nil }
 
    destination = destination.appendingPathComponent(url.lastPathComponent)        
 
    guard !FileManager.default.fileExists(atPath: destination.path()) else {
        print("No need to download \(url.lastPathComponent) as it already exists.")
        return destination
    }        
 
    let (source, _) = try await URLSession.shared.download(from: url)
    tryFileManager.default.moveItem(at: source, to: destination)
    print("Done downloading \(url.lastPathComponent)!")
    return destination
}

```
ç„¶ååœ¨Targeté¡¹ç›®ä¸­å¢åŠ ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œç”¨äºè¯»å–ä¸‹è½½åˆ°å…¬å…±åŒºåŸŸçš„æ•°æ®ã€‚

```objc
if let imageContainer = FileManager.default.containerURL(
    forSecurityApplicationGroupIdentifier: "group.com.test.liveactivityappgroup")?
    .appendingPathComponent(context.state.imageName),
   let uiImage = UIImage(contentsOfFile: imageContainer.path()) {
    Image(uiImage: uiImage)
        .resizable()
        .aspectRatio(contentMode: .fill)
        .frame(width: 50, height: 50)
}
```

### å›¾ç‰‡ä¼ å…¥ - éæœ¬åœ°åŒ–å›¾ç‰‡

#### æŠ€æœ¯é™åˆ¶

å› ä¸ºLive Activityå†…éƒ¨ç¦ç”¨ç½‘ç»œå›¾ç‰‡ï¼Œä¼ ç»Ÿçš„æœåŠ¡ç«¯ä¼ å›¾ç‰‡URLçš„æ–¹å¼æ— æ³•æ»¡è¶³å®é™…ä½¿ç”¨ï¼Œä½†æ˜¯å¸Œæœ›ä¼ å…¥è®¢å•å›¾ç‰‡æ¥ä¸ªæ€§åŒ–åœ°è¡¨è¾¾å¹¶ä¸”åŒºåˆ†ä¸åŒè®¢å•ã€‚

#### è§£å†³æ–¹æ¡ˆ

iOS 16 betaç‰ˆæ—¶å¯ä»¥é€šè¿‡åˆ›å»ºæ—¶å°†å›¾ç‰‡è½¬ä¸ºDataæ ¼å¼ä¼ å…¥å¡ç‰‡ï¼Œä½†æ˜¯iOS16.1è¯¥æ–¹æ¡ˆä»…é™ä¼ å…¥4KBå·¦å³çš„å›¾ç‰‡ï¼ˆAPIé™åˆ¶ï¼‰ï¼Œå› æ­¤æš‚æ—¶ä¸è€ƒè™‘éæœ¬åœ°å›¾ç‰‡æ–¹æ¡ˆï¼Œé‡‡ç”¨å†…ç½®å›¾ç‰‡æ–¹å¼å®ç°ã€‚

### 

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

å¥½æ–‡ç« :

ç›’é©¬ iOS Live Activity &â€œçµåŠ¨å²›â€é…é€åœºæ™¯å®è·µ

https://mp.weixin.qq.com/s?__biz=Mzg4MjE5OTI4Mw==&mid=2247497758&idx=1&sn=3cb172fcddbca8dc686dc32d0dc5cd94&scene=21&poc_token=HHr18WijXucGkF-wJSElRs-l3c8V-JV4_yNEB2Ti







- **æ•°æ®æ›´æ–°é™åˆ¶**ï¼šå®æ—¶æ´»åŠ¨ï¼ˆLive Activitiesï¼‰æœ¬èº«æ— æ³•è®¿é—®ç½‘ç»œæˆ–æ¥æ”¶ä½ç½®æ›´æ–°ã€‚æ›´æ–°æ•°æ®éœ€è¦é€šè¿‡ActivityKitæ¡†æ¶æˆ–è¿œç¨‹æ¨é€å®ç°ï¼Œä¸”é€šè¿‡æ¨é€æ›´æ–°çš„æ•°æ®å¤§å°ä¸èƒ½è¶…è¿‡4KBã€‚è¿™æ„å‘³ç€è¦è°¨æ…æ§åˆ¶æ‰€åŠ è½½å›¾ç‰‡çš„æ•°æ®é‡ã€‚
- **å›¾ç‰‡ä½¿ç”¨**ï¼šç”±äºç½‘ç»œé™åˆ¶ï¼ŒçµåŠ¨å²›å†…éƒ¨é€šå¸¸**æ— æ³•ç›´æ¥åŠ è½½ç½‘ç»œå›¾ç‰‡**ã€‚å»ºè®®ä½¿ç”¨å†…ç½®åœ¨Appèµ„äº§åº“ï¼ˆAssetsï¼‰ä¸­çš„æœ¬åœ°å›¾ç‰‡ï¼Œå¹¶æ³¨æ„æ§åˆ¶å›¾ç‰‡å¤§å°ã€‚







