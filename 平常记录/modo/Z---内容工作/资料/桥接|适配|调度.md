## ğŸŒ‰ æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### 1. **æ¡¥æ¥å™¨ï¼ˆBridgeï¼‰** - é€šä¿¡çš„æ¡¥æ¢

**æ¯”å–»ç†è§£**ï¼šå°±åƒè¿æ¥ä¸¤ä¸ªå²›å±¿çš„æ¡¥æ¢

- **å²›å±¿A**ï¼šJavaScriptä¸–ç•Œï¼ˆWebView/React Nativeï¼‰
- **å²›å±¿B**ï¼šåŸç”ŸiOSä¸–ç•Œï¼ˆObjective-C/Swiftï¼‰
- **æ¡¥æ¢**ï¼šBridgeï¼ˆè®©ä¸¤ä¸ªä¸–ç•Œå¯ä»¥äº’ç›¸é€šè¡Œï¼‰

**æŠ€æœ¯æœ¬è´¨**ï¼š

```
// Bridge çš„å…¸å‹å·¥ä½œåŸç†
@interface Bridge : NSObject
// ä»JSè°ƒç”¨åŸç”Ÿæ–¹æ³•
- (void)callNative:(NSString *)methodName 
           params:(NSDictionary *)params 
         callback:(JSValue *)callback;

// ä»åŸç”Ÿè°ƒç”¨JSæ–¹æ³•  
- (void)callJS:(NSString *)functionName 
        params:(NSDictionary *)params 
      callback:(NativeCallback)callback;

// ç›‘å¬åŒæ–¹çš„äº‹ä»¶
- (void)addEventListener:(NSString *)eventName 
                handler:(EventHandler)handler;
@end
```

**å®é™…å·¥ä½œæµç¨‹**ï¼š

```
JavaScriptå±‚ â†’ Bridgeæ¡¥æ¥å™¨ â†’ åŸç”ŸiOSå±‚
     â†“                              â†“
 ç‚¹å‡»æŒ‰é’®"æ”¯ä»˜"                  è°ƒç”¨æ”¯ä»˜æ’ä»¶
     â†“                              â†“
 ä¼ é€’è®¢å•æ•°æ® â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿”å›æ”¯ä»˜ç»“æœ
```

### 2. **åŒ…è£…å™¨ï¼ˆWrapperï¼‰** - é€‚é…å’Œå°è£…å±‚

**æ¯”å–»ç†è§£**ï¼šå°±åƒç”µæºé€‚é…å™¨

- **ä¸­å›½æ’å¤´**ï¼šJavaScriptçš„è°ƒç”¨æ–¹å¼
- **ç¾å›½æ’åº§**ï¼šiOSåŸç”Ÿçš„æ¥å£è§„èŒƒ
- **é€‚é…å™¨**ï¼šWrapperï¼ˆè®©ä¸åŒæ ‡å‡†çš„ä¸œè¥¿èƒ½å¤ŸååŒå·¥ä½œï¼‰

**æŠ€æœ¯ä½œç”¨**ï¼š

```
// Wrapper çš„å…¸å‹èŒè´£
@implementation JsWrapper

// 1. ç»Ÿä¸€JSè°ƒç”¨å…¥å£
- (void)callPlugin:(NSString *)pluginName 
           method:(NSString *)method 
          params:(NSDictionary *)params 
        callback:(JSCallback)callback {
    
    // 2. å‚æ•°è½¬æ¢å’ŒéªŒè¯
    NativeParams *nativeParams = [self convertJSToNative:params];
    
    // 3. è·¯ç”±åˆ°æ­£ç¡®çš„æ’ä»¶
    Plugin *targetPlugin = [self.pluginMgr getPluginWithName:pluginName];
    
    // 4. è°ƒç”¨åŸç”Ÿæ–¹æ³•
    [targetPlugin executeMethod:method 
                         params:nativeParams 
                       callback:^(NativeResult *result) {
        // 5. ç»“æœè½¬æ¢å›JSæ ¼å¼
        JSResult *jsResult = [self convertNativeToJS:result];
        callback(jsResult);
    }];
}

@end
```



### 3. **æ¸ é“ç®¡ç†å™¨ï¼ˆChannelMgrï¼‰** - å¤šé€šé“è°ƒåº¦ä¸­å¿ƒ

**ä½œç”¨**ï¼šç®¡ç†ä¸åŒçš„é€šä¿¡æ¸ é“ï¼Œæ¯”å¦‚ï¼š

- **WebView JavaScriptCore**ï¼šä¼ ç»ŸWebViewé€šä¿¡
- **React Native MessageQueue**ï¼šRNæ¡†æ¶é€šä¿¡
- **WKWebView MessageHandler**ï¼šç°ä»£WebViewé€šä¿¡
- **WebSocketé€šé“**ï¼šé•¿è¿æ¥é€šä¿¡

```
@interface ChannelMgr : NSObject
- (void)registerChannel:(NSString *)channelName handler:(ChannelHandler)handler;
- (void)sendMessage:(NSString *)message viaChannel:(NSString *)channelName;
- (id<Channel>)getOptimalChannel;  // è·å–æœ€ä¼˜é€šä¿¡æ¸ é“
@end
```



## ğŸ”„ å®Œæ•´é€šä¿¡æµç¨‹

### åœºæ™¯ï¼šJSè°ƒç”¨åŸç”Ÿç›¸å†ŒåŠŸèƒ½

```
// 1. JSå±‚å‘èµ·è°ƒç”¨
javascript: 
jsWrapper.callPlugin("PhotoPlugin", "pickImage", {
    maxCount: 5,
    allowCrop: true
}, function(result) {
    // å¤„ç†è¿”å›çš„å›¾ç‰‡
});

// 2. JsWrapperæ¥æ”¶å¹¶åŒ…è£…
- (void)callPlugin:(NSString *)pluginName... {
    // éªŒè¯å‚æ•°æœ‰æ•ˆæ€§
    // è½¬æ¢JSå¯¹è±¡ä¸ºåŸç”Ÿå­—å…¸
    // é€šè¿‡Bridgeå‘é€åˆ°åŸç”Ÿå±‚
    [self.bridge callNative:@"PluginExecutor"
                    params:@{
                        @"plugin": pluginName,
                        @"method": method, 
                        @"params": params
                    }
                  callback:callback];
}

// 3. Bridgeä¼ é€’åˆ°åŸç”Ÿå±‚
// 4. åŸç”Ÿæ’ä»¶å¤„ç†å¹¶è¿”å›ç»“æœ
// 5. ç»“æœé€šè¿‡Bridgeä¼ å›Wrapper
// 6. Wrapperè½¬æ¢æ•°æ®æ ¼å¼åå›è°ƒJS
```



## ğŸ—ï¸ æ¶æ„å±‚æ¬¡å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            JavaScriptå±‚                  â”‚ â† ä¸šåŠ¡é€»è¾‘
â”‚  (React Native/WebView/H5)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ JSè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              JsWrapper                  â”‚ â† åŒ…è£…å™¨ï¼šæ ¼å¼è½¬æ¢ã€è·¯ç”±
â”‚           (åŒ…è£…å™¨å±‚)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ æ ‡å‡†åŒ–æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Bridge                    â”‚ â† æ¡¥æ¥å™¨ï¼šé€šä¿¡æ¡¥æ¢
â”‚           (æ¡¥æ¥å±‚)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ åŸç”Ÿè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ChannelMgr                  â”‚ â† æ¸ é“ç®¡ç†ï¼šé€‰æ‹©æœ€ä½³é€šé“
â”‚           (æ¸ é“å±‚)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ æ’ä»¶A  â”‚     â”‚ æ’ä»¶B  â”‚     â”‚ æ’ä»¶C  â”‚ â† å…·ä½“åŠŸèƒ½å®ç°
â”‚(æ”¯ä»˜)  â”‚     â”‚(ç›¸å†Œ)  â”‚     â”‚(åˆ†äº«)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜
```



## ğŸ¯ è®¾è®¡ä»·å€¼æ€»ç»“

### æ¡¥æ¥å™¨ï¼ˆBridgeï¼‰çš„ä»·å€¼ï¼š

- **é€šä¿¡æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€JSä¸åŸç”Ÿé€šä¿¡åè®®
- **åŒå‘é€šä¿¡**ï¼šæ”¯æŒäº’ç›¸è°ƒç”¨å’Œäº‹ä»¶ä¼ é€’
- **åè®®æŠ½è±¡**ï¼šéšè—åº•å±‚é€šä¿¡ç»†èŠ‚

### åŒ…è£…å™¨ï¼ˆWrapperï¼‰çš„ä»·å€¼ï¼š

- **æ¥å£ç®€åŒ–**ï¼šä¸ºJSæä¾›ç®€å•ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼
- **æ•°æ®è½¬æ¢**ï¼šåœ¨JSå¯¹è±¡å’ŒåŸç”Ÿå¯¹è±¡é—´è½¬æ¢
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

### æ¸ é“ç®¡ç†å™¨ï¼ˆChannelMgrï¼‰çš„ä»·å€¼ï¼š

- **å¤šè·¯å¤ç”¨**ï¼šæ”¯æŒå¤šç§é€šä¿¡æ¸ é“
- **æ™ºèƒ½é€‰æ‹©**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜é€šé“
- **å®¹ç¾å¤‡ä»½**ï¼šå½“æŸä¸ªé€šé“å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢

**ç®€å•æ€»ç»“**ï¼š

- **æ¡¥æ¥å™¨** = ä¿®è·¯ï¼Œå»ºç«‹é€šä¿¡é€šé“
- **åŒ…è£…å™¨** = ç¿»è¯‘ï¼Œè½¬æ¢æ•°æ®æ ¼å¼
- **æ¸ é“ç®¡ç†å™¨** = è°ƒåº¦ï¼Œé€‰æ‹©æœ€ä½³è·¯çº¿

è¿™å¥—æ¶æ„è®©JavaScriptä»£ç èƒ½å¤Ÿåƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨åŸç”ŸåŠŸèƒ½ï¼Œæå¤§æå‡äº†æ··åˆå¼€å‘çš„ä½“éªŒå’Œæ•ˆç‡ã€‚