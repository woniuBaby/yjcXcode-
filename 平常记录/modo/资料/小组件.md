## 1. **协议要求 vs 可选方法**

### **必须实现的方法**

```
struct Provider: TimelineProvider {
    // ✅ 必须实现的3个核心方法
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date())
    }
    
    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        let entry = SimpleEntry(date: Date())
        completion(entry)
    }
    
    func getTimeline(in context: Context, completion: @escaping (Timeline<SimpleEntry>) -> ()) {
        let entry = SimpleEntry(date: Date())
        let timeline = Timeline(entries: [entry], policy: .atEnd)
        completion(timeline)
    }
}
```



### **可以简化的版本**

```
struct Provider: TimelineProvider {
    // 最简单的实现
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date())
    }
    
    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        completion(SimpleEntry(date: Date()))
    }
    
    func getTimeline(in context: Context, completion: @escaping (Timeline<SimpleEntry>) -> ()) {
        completion(Timeline(entries: [SimpleEntry(date: Date())], policy: .never))
    }
}
```



## 2. **各方法的详细要求**

### **placeholder() - 占位数据**

```
func placeholder(in context: Context) -> SimpleEntry {
    // ✅ 必须返回一个有效的 Entry
    // ✅ 用于小组件加载时的临时显示
    // ✅ 通常返回模拟数据或默认数据
    return SimpleEntry(date: Date(), text: "加载中...")
}
```



### **getSnapshot() - 快照数据**

```
func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
    // ✅ 必须调用 completion 回调
    // ✅ 用于小组件库中的预览
    // ✅ 可以返回真实数据或模拟数据
    let entry = SimpleEntry(date: Date(), text: "预览内容")
    completion(entry)
}
```



### **getTimeline() - 时间线数据**

```
func getTimeline(in context: Context, completion: @escaping (Timeline<SimpleEntry>) -> ()) {
    // ✅ 必须调用 completion 回调
    // ✅ 必须返回 Timeline 对象
    // ✅ Timeline 必须包含至少一个 Entry 数组
    // ✅ 必须指定更新策略
    
    let entries = [SimpleEntry(date: Date())]
    let timeline = Timeline(entries: entries, policy: .after(Date().addingTimeInterval(3600)))
    completion(timeline)
}
```



## 3. **Entry 的要求**

```
// ✅ 必须遵循 TimelineEntry 协议
// ✅ 必须包含 date 属性
struct SimpleEntry: TimelineEntry {
    let date: Date  // 必须有的属性
    
    // 其他自定义属性（可选）
    let title: String?
    let value: Int?
}
```



## 4. **Widget 配置的要求**

```
struct MyWidget: Widget {
    let kind: String = "MyWidget"  // ✅ 必须有的唯一标识
    
    var body: some WidgetConfiguration {
        // ✅ 必须返回 WidgetConfiguration
        StaticConfiguration(kind: kind, provider: Provider()) { entry in
            MyWidgetView(entry: entry)
        }
        .configurationDisplayName("我的小组件")  // ✅ 推荐有
        .description("显示一些信息")             // ✅ 推荐有
        .supportedFamilies([.systemSmall, .systemMedium]) // ✅ 推荐指定尺寸
    }
}
```



## 5. **实际项目中的简化示例**

### **极简小组件**

```
// 数据模型
struct SimpleEntry: TimelineEntry {
    let date: Date
    let message: String
}

// 数据提供者
struct Provider: TimelineProvider {
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date(), message: "加载中")
    }
    
    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        let entry = SimpleEntry(date: Date(), message: "快照数据")
        completion(entry)
    }
    
    func getTimeline(in context: Context, completion: @escaping (Timeline<SimpleEntry>) -> ()) {
        let entry = SimpleEntry(date: Date(), message: "当前时间: \(Date())")
        let timeline = Timeline(entries: [entry], policy: .after(Date().addingTimeInterval(300))) // 5分钟后更新
        completion(timeline)
    }
}

// 小组件配置
struct MyWidget: Widget {
    let kind: String = "MyWidget"
    
    var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider()) { entry in
            Text(entry.message)
        }
        .configurationDisplayName("时间显示")
        .description("显示当前时间")
    }
}
```



## 6. **总结要求**

| 组件                 | 必须要求                         | 可选内容                   |
| :------------------- | :------------------------------- | :------------------------- |
| **TimelineProvider** | 3个核心方法                      | 复杂的更新逻辑             |
| **Entry**            | 遵循 TimelineEntry，包含 date    | 其他自定义属性             |
| **Widget**           | kind 标识符，WidgetConfiguration | 显示名称、描述、支持的尺寸 |

**关键点**：

1. 三个核心方法**必须存在**且**必须调用 completion 回调**
2. Entry **必须有 date 属性**
3. Widget **必须有 kind 标识符**
4. 其他内容都可以根据需求简化或扩展

所以虽然模板提供了完整结构，但你完全可以根据实际需求简化实现。





---

灵动岛

<img src="/Users/lin/Library/Application Support/typora-user-images/image-20251013170551496.png" alt="image-20251013170551496" style="zoom:80%;" />

下面这个表格汇总了灵动岛三种类型的主要信息：

| 形态类型              | 显示场景与特点                                               | 内容与设计要点                                               | 关键尺寸 (单位: pt)                                          |
| :-------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **紧凑型 (Compact)**  | - **单个**实时活动时显示 - 环绕摄像头，分为**前后（Leading/Trailing）** 两个独立但视觉统一的区域 | - 展示**最关键**的摘要信息（如订单状态、计时器） - 避免敏感信息、广告 - 点击任意区域跳转至App对应页面 | **iPhone 14 Pro:** 52.33×36.67 (每侧) **iPhone 14 Pro Max:** 62.33×36.67 (每侧) |
| **最小型 (Minimal)**  | - **多个**实时活动同时存在时显示 - 系统选择**两个**应用"登岛" | - 主活动紧贴摄像头，另一个以**圆形图标**显示 - 内容极度精简，通常为一个**图标或字符** | **直径:** 36.67                                              |
| **扩展型 (Expanded)** | - 在紧凑型或最小型上**长按**触发 - 展示更丰富的详细信息      | - 布局通常分为**顶部、底部、左侧、右侧**等区域 - 是紧凑型内容的**扩展和补充** | **高度范围:** 84-160 **宽度:** iPhone 14 Pro: 371 iPhone 14 Pro Max: 408 |

